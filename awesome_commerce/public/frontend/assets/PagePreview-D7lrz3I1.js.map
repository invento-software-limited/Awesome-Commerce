{"version":3,"file":"PagePreview-D7lrz3I1.js","sources":["../../../../frontend/src/pages/PagePreview.vue"],"sourcesContent":["<template>\n\t<div class=\"flex h-screen flex-col items-center bg-surface-white py-2\">\n\t\t<div class=\"relative flex w-full items-center justify-center\">\n\t\t\t<router-link\n\t\t\t\t:to=\"{ name: 'builder', params: { pageId: route.params.pageId || 'new' } }\"\n\t\t\t\tclass=\"absolute left-3 flex w-fit text-sm text-ink-gray-7 hover:text-ink-gray-9\">\n\t\t\t\t<FeatherIcon name=\"arrow-left\" class=\"mr-4 h-4 w-4 cursor-pointer\" />\n\t\t\t\tBack to builder\n\t\t\t</router-link>\n\t\t\t<div class=\"flex gap-1\">\n\t\t\t\t<div\n\t\t\t\t\tclass=\"w-auto cursor-pointer rounded-md p-1 px-[8px]\"\n\t\t\t\t\tv-for=\"breakpoint in deviceBreakpoints\"\n\t\t\t\t\t:key=\"breakpoint.device\"\n\t\t\t\t\t:class=\"{\n\t\t\t\t\t\t'bg-surface-white': activeBreakpoint === breakpoint.device,\n\t\t\t\t\t}\"\n\t\t\t\t\t@click.stop=\"() => setWidth(breakpoint.device)\">\n\t\t\t\t\t<FeatherIcon\n\t\t\t\t\t\t:name=\"breakpoint.icon\"\n\t\t\t\t\t\tclass=\"h-6 w-5 text-ink-gray-4\"\n\t\t\t\t\t\t:class=\"{\n\t\t\t\t\t\t\t'text-ink-gray-9': activeBreakpoint === breakpoint.device,\n\t\t\t\t\t\t}\" />\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<PublishButton class=\"absolute right-3 border-0\"></PublishButton>\n\t\t</div>\n\t\t<div\n\t\t\tclass=\"relative mt-5 flex h-[85vh] bg-white\"\n\t\t\t:style=\"{\n\t\t\t\twidth: width + 'px',\n\t\t\t}\">\n\t\t\t<PanelResizer\n\t\t\t\tclass=\"ml-[-12px]\"\n\t\t\t\tside=\"left\"\n\t\t\t\t:dimension=\"width\"\n\t\t\t\t:minDimension=\"minWidth\"\n\t\t\t\t:maxDimension=\"maxWidth\"\n\t\t\t\t:resizeSensitivity=\"2\"\n\t\t\t\tref=\"leftPanelRef\"\n\t\t\t\t@resize=\"(val) => (width = val)\">\n\t\t\t\t<div class=\"resize-handler-left h-full w-2 rounded-sm bg-surface-gray-2\"></div>\n\t\t\t</PanelResizer>\n\t\t\t<iframe\n\t\t\t\t:src=\"previewRoute\"\n\t\t\t\tframeborder=\"0\"\n\t\t\t\tv-if=\"previewRoute\"\n\t\t\t\tclass=\"flex-1 rounded-sm\"\n\t\t\t\tref=\"previewWindow\"></iframe>\n\t\t\t<div v-if=\"loading || resizing\" class=\"absolute flex h-full w-full items-center justify-center\"></div>\n\t\t\t<PanelResizer\n\t\t\t\tclass=\"mr-[-8px]\"\n\t\t\t\tside=\"right\"\n\t\t\t\t:dimension=\"width\"\n\t\t\t\t:minDimension=\"minWidth\"\n\t\t\t\t:maxDimension=\"maxWidth\"\n\t\t\t\t:resizeSensitivity=\"2\"\n\t\t\t\tref=\"rightPanelRef\"\n\t\t\t\t@resize=\"(val) => (width = val)\">\n\t\t\t\t<div class=\"resize-handler-left h-full w-2 rounded-sm bg-surface-gray-2\"></div>\n\t\t\t</PanelResizer>\n\t\t</div>\n\t</div>\n</template>\n<script lang=\"ts\" setup>\nimport PanelResizer from \"@/components/PanelResizer.vue\";\nimport PublishButton from \"@/components/PublishButton.vue\";\nimport router from \"@/router\";\nimport useStore from \"@/store\";\nimport { posthog } from \"@/telemetry\";\nimport { useEventListener } from \"@vueuse/core\";\nimport { Ref, computed, onActivated, ref, watch, watchEffect } from \"vue\";\nimport { useRoute } from \"vue-router\";\n\nconst route = useRoute();\nconst maxWidth = window.innerWidth * 0.92;\nconst minWidth = 400;\nlet previewRoute = ref(\"\");\nconst width = ref(maxWidth);\nconst loading = ref(false);\nconst store = useStore();\nconst publishing = ref(false);\n\nconst deviceBreakpoints = [\n\t{\n\t\ticon: \"monitor\",\n\t\tdevice: \"desktop\",\n\t\twidth: 1400,\n\t},\n\t{\n\t\ticon: \"tablet\",\n\t\tdevice: \"tablet\",\n\t\twidth: 800,\n\t},\n\t{\n\t\ticon: \"smartphone\",\n\t\tdevice: \"mobile\",\n\t\twidth: 420,\n\t},\n];\n\nconst leftPanelRef = ref<InstanceType<typeof PanelResizer> | null>(null);\nconst rightPanelRef = ref<InstanceType<typeof PanelResizer> | null>(null);\n\nconst resizing = computed(() => leftPanelRef.value?.dragActive || rightPanelRef.value?.dragActive);\n\nconst activeBreakpoint = computed(() => {\n\tconst tabletBreakpoint = deviceBreakpoints.find((b) => b.device === \"tablet\");\n\tconst mobileBreakpoint = deviceBreakpoints.find((b) => b.device === \"mobile\");\n\tif (width.value <= (mobileBreakpoint?.width || minWidth)) {\n\t\treturn \"mobile\";\n\t}\n\tif (width.value <= (tabletBreakpoint?.width || maxWidth)) {\n\t\treturn \"tablet\";\n\t}\n\treturn \"desktop\";\n});\n\nconst previewWindow = ref(null) as Ref<HTMLIFrameElement | null>;\n\nuseEventListener(document, \"keydown\", (ev) => {\n\tif (ev.key === \"Escape\" && router.currentRoute.value.name === \"preview\") {\n\t\thistory.back();\n\t}\n});\n\n// hack to relay mouseup event from iframe to parent\nwatchEffect(() => {\n\tif (previewWindow.value) {\n\t\tloading.value = true;\n\t\tpreviewWindow.value.addEventListener(\n\t\t\t\"load\",\n\t\t\t() => {\n\t\t\t\tsetTimeout(() => {\n\t\t\t\t\tloading.value = false;\n\t\t\t\t}, 100);\n\t\t\t\tpreviewWindow.value?.addEventListener(\"mousedown\", (ev) => {\n\t\t\t\t\tdocument.dispatchEvent(new MouseEvent(\"mousedown\", ev));\n\t\t\t\t});\n\t\t\t\tpreviewWindow.value?.contentWindow?.document.addEventListener(\"mouseup\", (ev) => {\n\t\t\t\t\tdocument.dispatchEvent(new MouseEvent(\"mouseup\", ev));\n\t\t\t\t});\n\t\t\t\tpreviewWindow.value?.contentWindow?.document.addEventListener(\"mousemove\", (ev) => {\n\t\t\t\t\tdocument.dispatchEvent(new MouseEvent(\"mousemove\", ev));\n\t\t\t\t});\n\t\t\t},\n\t\t\t{ once: true },\n\t\t);\n\t}\n});\n\nconst setWidth = (device: string) => {\n\tconst breakpoint = deviceBreakpoints.find((b) => b.device === device);\n\tif (breakpoint) {\n\t\tif (breakpoint.device === \"desktop\") {\n\t\t\twidth.value = maxWidth;\n\t\t} else {\n\t\t\twidth.value = breakpoint.width;\n\t\t}\n\t}\n};\n\nconst setPreviewURL = () => {\n\tlet queryParams = {\n\t\tpage: route.params.pageId,\n\t\t...store.routeVariables,\n\t};\n\tpreviewRoute.value = `/api/method/builder.api.get_page_preview_html?${Object.entries(queryParams)\n\t\t.map(([key, value]) => `${key}=${value}`)\n\t\t.join(\"&\")}`;\n};\n\nwatch(\n\t() => route.params.pageId,\n\t() => {\n\t\tsetPreviewURL();\n\t},\n\t{ immediate: true },\n);\n\nonActivated(() => {\n\tposthog.capture(\"builder_page_preview_viewed\");\n});\n</script>\n"],"names":["minWidth","route","useRoute","maxWidth","previewRoute","ref","width","loading","store","useStore","deviceBreakpoints","leftPanelRef","rightPanelRef","resizing","computed","_a","_b","activeBreakpoint","tabletBreakpoint","b","mobileBreakpoint","previewWindow","useEventListener","ev","router","watchEffect","_c","_e","_d","setWidth","device","breakpoint","setPreviewURL","queryParams","__spreadValues","key","value","watch","onActivated","posthog","_openBlock","_createElementBlock","_hoisted_1","_createElementVNode","_hoisted_2","_createVNode","_component_router_link","_unref","_component_FeatherIcon","_hoisted_3","_Fragment","_renderList","_withModifiers","PublishButton","_normalizeStyle","PanelResizer","_cache","val","_hoisted_6"],"mappings":"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"}